<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1 id="points">Points: 0</h1>
    <canvas id="myCanvas" width="500" height="500"></canvas>
    <script>
        let canvas = document.getElementById('myCanvas');
        let ctx = canvas.getContext('2d');
        let isDrawing = false;
        let points = 0;

        function surfaceCercle(rayon) {
            return Math.PI * rayon * rayon;
        }

        let surfaceTotale = canvas.width * canvas.height;

        function attribuerPoints(surfaceGommee) {
            let pourcentageGomme = (surfaceGommee / surfaceTotale) * 100;
            let pointsAttribues = (pourcentageGomme / 100) * 50; // 50 points pour 100% de la surface gommée
            return pointsAttribues;
        }

        function gommer(x, y, rayon) {
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, rayon, 0, Math.PI * 2, true);
            ctx.fill();

            let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let pixelIndex = (y * canvas.width + x) * 4; // Trouver l'indice du pixel dans les données de l'image
            let alphaValue = imageData.data[pixelIndex + 3]; // Récupérer la valeur alpha du pixel

            // Si le pixel est déjà transparent, ne pas attribuer de points
            if (alphaValue !== 0) {
                let surfaceGommee = surfaceCercle(rayon);
                let pointsGagnes = attribuerPoints(surfaceGommee);
                points += pointsGagnes;

                document.getElementById('points').innerText = "Points: " + points.toFixed(2);
            }
        }

        let img = new Image();
        img.src = 'source/image/above_the_birds.png';

        img.onload = function () {
            ctx.drawImage(img, 0, 0);
        };

        canvas.addEventListener('mousedown', function (e) {
            isDrawing = true;
            let rect = canvas.getBoundingClientRect();
            let x = e.clientX - rect.left;
            let y = e.clientY - rect.top;
            gommer(x, y, 20);
        });

        canvas.addEventListener('mousemove', function (e) {
            if (isDrawing) {
                let rect = canvas.getBoundingClientRect();
                let x = e.clientX - rect.left;
                let y = e.clientY - rect.top;
                gommer(x, y, 20);
            }
        });

        canvas.addEventListener('mouseup', function () {
            isDrawing = false;
        });

    </script>
</body>
</html>
